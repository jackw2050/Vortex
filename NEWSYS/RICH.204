CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C        
        SUBROUTINE XMIT(COMMAND,VAL)
C
C  XMIT TRANSMITS A COMMAND TO THE METER CONTROL MODULE
C
C  CALL:  INTEGER COMMAND(NMAX)
C         CALL NITEIA(LOCFAR(RQCMDS))
C         COMMAND(1):=COMMAND
C         COMMAND(2):=SUPPORT BYTE 1
C         COMMAND(N):=SUPPORT BYTE N-1
C         CALL(COMMAND,N-1)
C
C  RETURNS:  NOTHING
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C  NMAX CAN BE AS LARGE AS YOU WANT IT (BE CONSISTENT THRU-OUT SUBROUTINES)
        INCLUDE 'RICHARD.INC'
C
        INTEGER*2 COMMAND(0:NMAX),VAL
        INTEGER*2 I
        INTEGER*1 CHECKSUM
C
C        CALL EIAWRT(INT1(VAL+2))
C        CHECKSUM=INT1(VAL+2)
        CHECKSUM =0
        DO 10 I=0,VAL
          CALL EIBWRT(INT1(COMMAND(I)))
c          CALL EIAWRT(INT1(COMMAND(I)))
          CHECKSUM=IEOR(CHECKSUM,INT1(COMMAND(I)))
C         PRINT '(1H ,Z)', INT1(COMMAND(I))
10      CONTINUE
        CALL EIBWRT(CHECKSUM)
c        CALL EIAWRT(CHECKSUM)
50      RETURN
        END
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
        SUBROUTINE RECV(COMMAND,VAL)
C
C  RECV RETRIEVES A COMMAND FROM THE METER CONTROL MODULE
C
C  CALL:  INTEGER COMMAND(NMAX),M
C         CALL NITEIA(LOCFAR(RQCMDS))
C         IF (RQCMDS .GT. 0) CALL RECV(COMMAND,M)
C
C  RETURNS:  M:=N-1
C            COMMAND(1):=COMMAND
C            COMMAND(2):=SUPPORT BYTE 1
C            COMMAND(N):=SUPPORT BYTE M
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C  NMAX CAN BE AS LARGE AS YOU WANT IT (BE CONSISTENT THRU-OUT SUBROUTINES)
C  RQSIZE MUST BE <= 255 (BE CONSISTENT THRU-OUT SUBROUTINES)
        INCLUDE 'RICHARD.INC'
C
        INTEGER*2 COMMAND(NMAX),VAL,TABLE(0:10)
        INTEGER*1 I
        DATA TABLE /1,1,7,2,24,24,4,4,12,0,8/
C
        IF (RQCMDS .GT. 0) THEN
          RQBOT=RQBOT-1
          IF (RQBOT .EQ. 0) RQBOT=RQMAX
          COMMAND(1)=IAND(RQ(RQBOT),255)
          VAL=TABLE(COMMAND(1))
          RQCNT=RQCNT-1
          DO 20 I=2,VAL+1
            RQBOT=RQBOT-1
            IF (RQBOT .EQ. 0) RQBOT=RQMAX
            COMMAND(I)=IAND(RQ(RQBOT),255)
            RQCNT=RQCNT-1
20        CONTINUE
          RQCMDS=RQCMDS-1
        ENDIF
        RETURN
        END
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
        SUBROUTINE CLRQ
C
C  CLRQ INITIALIZES/RESETS THE RECEIVER QUEUE
C
C  CALL:  CALL CLRQ
C
C  RETURNS:  NOTHING
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C  RQSIZE MUST BE <= 255 (BE CONSISTENT THRU-OUT SUBROUTINES)
        INCLUDE 'RICHARD.INC'
C
        RQCMDS=0
        RQSTAT=0
        RQMAX=RQSIZE
        RQBOT=1
        RQTOP=1
        RQCNT=0
        CHKSUM=0
        RETURN
        END


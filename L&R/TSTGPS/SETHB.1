        PROGRAM TSTHB
C TEST SETHB ROUTINE TO SET HEARTBEAT RATE TO 200 HZ
        CALL SETHB
        END
C ******************** SETHB ******************************
C SETS THE HEARTBEAT RATE TO 200 HZ
C DIVISOR = 15000 = #3A98
C DUAL PORT CONTROL ONE LSB ADDRESS = #9D
C DUAL PORT CONTROL ONE MSB ADDRESS = #9E
C DUAL PORT REJAM ADDRESS = 18 = #12
C DUAL PORT SET CONTROL ONE ADDRESS = 14 =#0E
C DUAL PORT COMMAND ADDRESS = #FF
C
        SUBROUTINE SETHB
        INTEGER*2 LSB,MSB,JAM,CTL,CMD
        PARAMETER (LSB=#9D,MSB=#9E,JAM=#12,CTL=#0E,CMD=#FF)
        CALL SETDPRAM(LSB,INT2(#98))   !SET LS BYTE
        CALL SETDPRAM(MSB,INT2(#3A))   !SET MS BYTE
c        CALL SETDPRAM(CMD,JAM)   !REJAM TO ALIGN WITH 1HZ PULSE
        CALL SETDPRAM(CMD,CTL)   !USE IF NO HZ PULSE
        END
C********************* SETDPRAM ***************************
C  SET VALUES IN DUAL PORT RAM
C  IADD = ADDRESS IN DUAL PORT RAM
C  IVAL = VALUE TO SET IN DUAL PORT RAM
C  CALL SETDPRAM (IADD,IVAL) IADD AND IVAL INTERGER*2
C  READS AND RETURNS SET VALUE IN IVAL. SHOULD EQUAL INPUT
C  RESPONSE READY MASK = #02
C  EXTENDED STATUS PORT ADDRESS= #03
C  DUAL RAM DATA PORT ADDRESS = #02
C  DUAL RAM ADDRESS PORT ADDRESS = #06
C
        SUBROUTINE SETDPRAM (IADD,IVAL)
        INTEGER*2 IADD,IVAL,IRES,I
        INTEGER*2 SGBASE,MSK,STA,DAT,ADR
        PARAMETER (SGBASE=#02A0,MSK=#02,STA=#03,DAT=#02,ADR=#06)
C
        CALL FETCH (SGBASE+DAT,IRES)    !CLEAR RESPONSE FLAG
        CALL OUTPUT(SGBASE+ADR,IADD)    !SET ADDRESS TO WRITE TO
        DOWHILE (IRES .EQ. 0)           !MAKE SURE VALUE IS SET
            CALL FETCH(SGBASE+STA,IRES)
            IRES = IRES .AND. MSK       !RESPONSE READY MASK
        ENDDO
        DO I=1,200                      !DELAY TO ASSURE SPACING
            CALL FETCH(SGBASE+STA,IRES)
        ENDDO
        CALL FETCH(SGBASE+DAT,IRES)     !DISCARD OLD VALUE
        CALL OUTPUT(SGBASE+DAT,IVAL)    !SET NEW VALUE
        DOWHILE (IRES .EQ. 0)           !MAKE SURE VALUE IS SET
            CALL FETCH(SGBASE+STA,IRES)
            IRES = IRES .AND. MSK       !RESPONSE READY MASK
        ENDDO
        DO I=1,200                      !DELAY TO ASSURE SPACING
            CALL FETCH(SGBASE+STA,IRES)
        ENDDO
        ival = 0
        CALL FETCH(SGBASE+DAT,IVAL)     !READ AND RETURN NEW VALUE
        print *, ival
        END
c ***********************  HZ_200 *************************
        SUBROUTINE HZ_200
        RETURN
        END


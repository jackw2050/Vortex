C ************************* IAD ***************************
C INLINE SUBROUTINE IAD
C READS 16 CHANNELS WITH PRESELECTED GAIN
C        INCLUDE 'PROLOGUE.INC'
        DO ICH=0,15
C SET GAIN AND CHANEL
        PORTAB = IAND(PORTAB,#02)  !CLEAR CONTROL BITS
        IVALUE = ICH
        IVALUE = ISHFT(IVALUE,12)  !SET CHANNEL
        IVALUE = IOR(IVALUE,IRAW(ICH,0))  !SET GAIN
        PORTAB = IOR(PORTAB,IVALUE)
        CALL OUTPUTW (IOADD(15),PORTAB)   !SAVE GAIN AND SET CHANNEL
        IVALUE = 0
        I = 0
        IVOLTH = 0
        IVOLTL = 0
        CALL OUTPUTW (IOADD(0),IVALUE)    !START CONVERSION
20      CONTINUE
        CALL FETCHW (IOADD(14),IVALUE)     !DATA READY ?
        IF (.NOT.BTEST(IVALUE,5)) THEN
           I = I+1
           IF (I .GT. 100) GOTO 40
           GOTO 20
        ENDIF
        DO I=1,1000             !CREATE A SHORT DELAY
          J=1-J
        enddo
C       DO IT AGAIN (DOUBLE BUFFERED)
        CALL OUTPUTW (IOADD(0),IVALUE)    !START CONVERSION
21      CONTINUE
        CALL FETCHW (IOADD(14),IVALUE)     !DATA READY ?
        IF (.NOT.BTEST(IVALUE,5)) THEN
           I = I+1
           IF (I .GT. 100) GOTO 40
           GOTO 21
        ENDIF
        CALL FETCHW (IOADD(0),IVOLTH)  !GET HIGH BYTE
        CALL FETCHW (IOADD(1),IVOLTL)  !GET LOW BYTE
        IRAW(ICH,1) = ISHFT (IVOLTH,8)
        IVOLTL = IAND (IVOLTL,#FF)
        IRAW(ICH,1) = IOR (IRAW(ICH,1),IVOLTL)
        ENDDO
        PORTAB = IAND(PORTAB,#02)  !CLEAR CONTROL BITS
        PORTAB = IOR(PORTAB,IRAW(ICH,0))     !RESET TO CH 0
        CALL OUTPUTW (IOADD(15),PORTAB)   !SAVE GAIN AND SET CHANNEL
        RETURN
40      PRINT *, 'TIMED OUT'
        RETURN
        END

